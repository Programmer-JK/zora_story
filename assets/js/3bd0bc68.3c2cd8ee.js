"use strict";(self.webpackChunkjk_story=self.webpackChunkjk_story||[]).push([[3711],{6259:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>a,frontMatter:()=>o,metadata:()=>c,toc:()=>h});var i=t(4848),s=t(8453);const o={},r=void 0,c={id:"Next.js/trouble-shooting/JWT \uc778\uc99d\uacfc \ud1a0\ud070 \uc7ac\ubc1c\uae09",title:"JWT \uc778\uc99d\uacfc \ud1a0\ud070 \uc7ac\ubc1c\uae09",description:"\uc791\uc131\uc77c : 2025.01.02",source:"@site/docs/09. Next.js/090100. trouble-shooting/090101. JWT \uc778\uc99d\uacfc \ud1a0\ud070 \uc7ac\ubc1c\uae09.md",sourceDirName:"09. Next.js/090100. trouble-shooting",slug:"/Next.js/trouble-shooting/JWT \uc778\uc99d\uacfc \ud1a0\ud070 \uc7ac\ubc1c\uae09",permalink:"/zora_story/docs/Next.js/trouble-shooting/JWT \uc778\uc99d\uacfc \ud1a0\ud070 \uc7ac\ubc1c\uae09",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:90101,frontMatter:{},sidebar:"studySidebar",previous:{title:"React \uba74\uc811 \uc900\ube44",permalink:"/zora_story/docs/React.js/React \uba74\uc811 \uc900\ube44"},next:{title:"Next.js Hydration \uc5d0\ub7ec",permalink:"/zora_story/docs/Next.js/trouble-shooting/Next.js Hydration \uc5d0\ub7ec"}},l={},h=[{value:"\uc2dc\uc791: Fetch \ud568\uc218 \ubd84\ub9ac",id:"\uc2dc\uc791-fetch-\ud568\uc218-\ubd84\ub9ac",level:2},{value:"\ubb38\uc81c\uc810 \ubc1c\uacac",id:"\ubb38\uc81c\uc810-\ubc1c\uacac",level:2},{value:"\uacb0\ub860",id:"\uacb0\ub860",level:2},{value:"\uc2e4\uc81c \uc0ac\uc6a9 \uc608\uc2dc",id:"\uc2e4\uc81c-\uc0ac\uc6a9-\uc608\uc2dc",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\uc791\uc131\uc77c : 2025.01.02"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\uc2dc\uc791-fetch-\ud568\uc218-\ubd84\ub9ac",children:"\uc2dc\uc791: Fetch \ud568\uc218 \ubd84\ub9ac"}),"\n",(0,i.jsx)(n.p,{children:"\ucc98\uc74c\uc5d0\ub294 \uae30\ub2a5\ubcc4\ub85c \ubd84\ub9ac\ud558\uc5ec \uad6c\ud604\ud588\uc2b5\ub2c8\ub2e4:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\uae30\ubcf8 Fetch \ud568\uc218"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const Fetch = async (input: RequestInfo | URL, init?: RequestInit) => {\n  return fetch(input, init);\n};\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"\ucfe0\ud0a4\ub97c \ucc98\ub9ac\ud558\ub294 FetchWithCookie"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const FetchWithCookie = async (\n  input: RequestInfo | URL,\n  init?: RequestInit\n) => {\n  if (process.env.NODE_ENV === 'production' && isServer) {\n    try {\n      const cookies = await getServerCookies();\n      const cookieString = cookies().toString();\n      return Fetch(input, {\n        ...init,\n        headers: {\n          ...init?.headers,\n          'Content-Type': 'application/json',\n          Cookie: cookieString,\n        },\n        credentials: 'include',\n      });\n    } catch (error) {\n      console.error('Failed to get server cookies:', error);\n      return Fetch(input, {\n        ...init,\n        credentials: 'include',\n      });\n    }\n  }\n\n  return Fetch(input, {\n    ...init,\n    credentials: 'include',\n  });\n};\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"JWT \ud1a0\ud070 \ucc98\ub9ac\ub97c \ud558\ub294 FetchWithJWT"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export const FetchWithJWT = async (\n  input: RequestInfo | URL,\n  init?: RequestInit\n) => {\n  const res = await FetchWithCookie(input, init);\n\n  if (res.status === 401) {\n    const tokensRequest = await fetch('api/reissue', init);\n    if (!tokensRequest.ok) return redirect('/login');\n\n    if (process.env.NODE_ENV === 'production' && isServer) {\n      const cookies = await getServerCookies();\n      const newCookies = tokensRequest.headers.getSetCookie();\n      newCookies.forEach((cookie) => {\n        const [name, value] = cookie.split('=');\n        cookies().set(name, value);\n      });\n    }\n\n    return FetchWithCookie(input, init);\n  } else {\n    return res;\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\ubb38\uc81c\uc810-\ubc1c\uacac",children:"\ubb38\uc81c\uc810 \ubc1c\uacac"}),"\n",(0,i.jsx)(n.p,{children:"\ucf54\ub4dc\ub97c \ub9ac\ubdf0\ud558\uba74\uc11c \ub2e4\uc74c\uacfc \uac19\uc740 \ubb38\uc81c\uc810\uc744 \ubc1c\uacac\ud588\uc2b5\ub2c8\ub2e4:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FetchWithCookie"}),"\ub294 \uc0ac\uc2e4\uc0c1 ",(0,i.jsx)(n.code,{children:"FetchWithJWT"})," \uc548\uc5d0\uc11c\ub9cc \uc0ac\uc6a9\ub418\ub294 \uc911\uac04 \ub2e8\uacc4\uc758 \ud568\uc218"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FetchWithJWT"}),"\uac00 ",(0,i.jsx)(n.code,{children:"FetchWithCookie"}),"\uc758 \uae30\ub2a5\uc744 \ud3ec\ud568\ud558\uc5ec \ucc98\ub9ac\ud560 \uc218 \uc788\uc74c"]}),"\n",(0,i.jsx)(n.li,{children:"\ubd88\ud544\uc694\ud55c \ud568\uc218 \ubd84\ub9ac\ub85c \uc778\ud55c \ucf54\ub4dc \ubcf5\uc7a1\ub3c4 \uc99d\uac00"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\uacb0\ub860",children:"\uacb0\ub860"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FetchWithCookie"})," \ud568\uc218\ub294 \ubd88\ud544\uc694\ud55c \uc911\uac04 \ub2e8\uacc4\uc600\uc74c"]}),"\n",(0,i.jsxs)(n.li,{children:["\ucfe0\ud0a4 \ucc98\ub9ac\uc640 \ud1a0\ud070 \uc7ac\ubc1c\uae09 \ubaa8\ub450 ",(0,i.jsx)(n.code,{children:"FetchWithJWT"}),"\uc5d0\uc11c \ud55c\ubc88\uc5d0 \ucc98\ub9ac \uac00\ub2a5"]}),"\n",(0,i.jsxs)(n.li,{children:["\uacb0\uad6d ",(0,i.jsx)(n.code,{children:"FetchWithJWT"}),"\ub9cc \uc0ac\uc6a9\ud558\uba74 \ub418\ub294 \uc0c1\ud669"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\uc2e4\uc81c-\uc0ac\uc6a9-\uc608\uc2dc",children:"\uc2e4\uc81c \uc0ac\uc6a9 \uc608\uc2dc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// API \ud638\ucd9c \uc2dc\nconst response = await FetchWithJWT('/recommend', {\n  next: { revalidate: 1200 },\n});\n\nif (response.ok) {\n  const data = await response.json();\n  // \ub370\uc774\ud130 \ucc98\ub9ac\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\uc774\ub807\uac8c \uad6c\ud604\ud558\uba74 JWT \uc778\uc99d\uc774 \ud544\uc694\ud55c \ubaa8\ub4e0 API \uc694\uccad\uc5d0\uc11c:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\ucfe0\ud0a4\uc5d0 \uc800\uc7a5\ub41c JWT \ud1a0\ud070\uc744 \ud3ec\ud568\ud558\uc5ec \uc694\uccad"}),"\n",(0,i.jsx)(n.li,{children:"\ud1a0\ud070 \ub9cc\ub8cc \uc2dc(401 \uc5d0\ub7ec) \uc790\ub3d9\uc73c\ub85c \uc7ac\ubc1c\uae09"}),"\n",(0,i.jsx)(n.li,{children:"\uc7ac\ubc1c\uae09 \uc2e4\ud328 \uc2dc \ub85c\uadf8\uc778 \ud398\uc774\uc9c0\ub85c \ub9ac\ub2e4\uc774\ub809\ud2b8"}),"\n",(0,i.jsx)(n.li,{children:"\ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c\uc758 \uc11c\ubc84\uc0ac\uc774\ub4dc \ucfe0\ud0a4 \ucc98\ub9ac"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\ubaa8\ub4e0 \uacfc\uc815\uc774 ",(0,i.jsx)(n.code,{children:"FetchWithJWT"})," \ud558\ub098\ub85c \ucc98\ub9ac\ub429\ub2c8\ub2e4."]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var i=t(6540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);