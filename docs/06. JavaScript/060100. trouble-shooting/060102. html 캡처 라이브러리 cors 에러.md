
>ì‘ì„±ì¼ : 2025.04.14 

`html-to-image` ë˜ëŠ” `html2canvas`ë¥¼ ì‚¬ìš©í•´ DOM ìš”ì†Œë¥¼ ì´ë¯¸ì§€ë¡œ ì¶”ì¶œí•  ë•Œ, ì™¸ë¶€ ì´ë¯¸ì§€ë‚˜ CSSì— í¬í•¨ëœ ë¦¬ì†ŒìŠ¤ ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì€ CORS ì—ëŸ¬ê°€ ìì£¼ ë°œìƒí•˜ì—¬ ì´ë²ˆ ê¸°íšŒì— ì •ë¦¬í•˜ê³ ì í•©ë‹ˆë‹¤.

```
SecurityError: Failed to read the 'cssRules' property from 'CSSStyleSheet'
Access to fetch at [image URL] from origin 'null' has been blocked by CORS policy
```

---

## ğŸ’£ ë¬¸ì œ ì›ì¸

- **ì™¸ë¶€ ì´ë¯¸ì§€** ë˜ëŠ” **ì™¸ë¶€ CSSì—ì„œ ì°¸ì¡°ë˜ëŠ” ì´ë¯¸ì§€**ê°€ **CORS ì •ì±…ì— ì˜í•´ ë¸Œë¼ìš°ì €ì—ì„œ ì°¨ë‹¨**ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- Canvasë¡œ ê·¸ë¦¬ê¸° ìœ„í•´ì„  ë¦¬ì†ŒìŠ¤ê°€ **ë™ì¼ ì¶œì²˜**ì´ê±°ë‚˜, í•´ë‹¹ ì„œë²„ê°€ **Access-Control-Allow-Origin**ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
- ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Canvas ìì²´ê°€ "tainted"ë˜ì–´ `toDataURL()` í˜¸ì¶œ ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.

---

## âœ… í•´ê²° ë°©ë²• ìš”ì•½

| ë°©ë²• | ì„¤ëª… | ì¥ì  | ë‹¨ì  |
|------|------|------|------|
| 1. ì™¸ë¶€ ì´ë¯¸ì§€ Base64ë¡œ ë³€í™˜ | JavaScriptë¡œ ì´ë¯¸ì§€ ë¡œë“œ í›„ Base64 ë³€í™˜í•˜ì—¬ ì§ì ‘ ì‚½ì… | ê°„ë‹¨, í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í•´ê²° ê°€ëŠ¥ | CORS í—ˆìš©ëœ ì´ë¯¸ì§€ì—ë§Œ ê°€ëŠ¥ |
| 2. ì´ë¯¸ì§€ í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš© | ì™¸ë¶€ ì´ë¯¸ì§€ë¥¼ ë°±ì—”ë“œì—ì„œ ë°›ì•„ì™€ CORS í—ˆìš© í›„ ì „ë‹¬ | ëª¨ë“  ì´ë¯¸ì§€ ì§€ì› ê°€ëŠ¥ | ì„œë²„ ê°œë°œ í•„ìš” |
| 3. CSSì˜ ì™¸ë¶€ ì´ë¯¸ì§€ ì§ì ‘ Base64 ì‚½ì… | `url(data:image/png;base64,...)` í˜•ì‹ìœ¼ë¡œ CSS ìˆ˜ì • | ì™„ì „í•œ í•´ê²° | CSS ìˆ˜ì • í•„ìš” |
| 4. ë¹Œë“œ ë„êµ¬ë¡œ ìë™ ì¸ë¼ì¸ ì²˜ë¦¬ | webpack/Viteì—ì„œ assetì„ Base64ë¡œ ìë™ ì¸ë¼ì¸ | ìœ ì§€ë³´ìˆ˜ ì‰¬ì›€ | ë²ˆë“¤ëŸ¬ ì‚¬ìš© í•„ìš” |
| 5. html2canvas + `useCORS: true` | ê°„ë‹¨í•œ ì˜µì…˜ ì‚¬ìš© | ë¹ ë¥¸ ì‹œë„ | ì—¬ì „íˆ CORS ì°¨ë‹¨ ì‹œ ì‹¤íŒ¨í•¨ |

---

## ğŸ”§ 1. ì™¸ë¶€ ì´ë¯¸ì§€ Base64ë¡œ ë³€í™˜ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ)

```ts
function imageUrlToBase64(url) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = () => {
      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      canvas.getContext("2d").drawImage(img, 0, 0);
      try {
        resolve(canvas.toDataURL("image/png"));
      } catch (e) {
        reject(e);
      }
    };
    img.onerror = reject;
    img.src = url;
  });
}

// ì‚¬ìš© ì˜ˆì‹œ
imageUrlToBase64("https://example.com/image.png").then((base64) => {
  document.querySelector("#img").src = base64;
});
```

> ì´ ë°©ì‹ì€ ì´ë¯¸ì§€ê°€ CORS í—ˆìš© ìƒíƒœì—¬ì•¼ë§Œ ë™ì‘í•©ë‹ˆë‹¤.

---

## ğŸ”§ 2. í”„ë¡ì‹œ ì„œë²„ë¥¼ í†µí•´ ì´ë¯¸ì§€ ìš°íšŒ

Node.js Express ì˜ˆì‹œ:

```ts
app.get('/proxy-image', async (req, res) => {
  const imageUrl = req.query.url;
  const response = await fetch(imageUrl);
  const buffer = await response.buffer();
  res.set('Content-Type', 'image/png');
  res.set('Access-Control-Allow-Origin', '*');
  res.send(buffer);
});
```

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ:
```html
<img src="/proxy-image?url=https://example.com/image.png" />
```

---

## ğŸ”§ 3. CSSì˜ ì™¸ë¶€ ì´ë¯¸ì§€ â†’ Base64ë¡œ ì§ì ‘ ì‚½ì…

```css
/* before */
.element {
  background-image: url('https://example.com/bg.png');
}

/* after */
.element {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA...');
}
```

---

## ğŸ”§ 4. Vite/Webpackì—ì„œ ìë™ ì¸ë¼ì¸ ì²˜ë¦¬

### Vite ì˜ˆì‹œ
```ts
export default defineConfig({
  build: {
    assetsInlineLimit: 100_000, // 100KB ì´í•˜ ì´ë¯¸ì§€ëŠ” base64ë¡œ ìë™ ì¸ë¼ì¸ë¨
  },
});
```

### Webpack ì˜ˆì‹œ (url-loader)
```js
{
  test: /\.(png|jpg|gif)$/i,
  use: [
    {
      loader: 'url-loader',
      options: {
        limit: 8192, // 8KB ì´í•˜ì¼ ê²½ìš° base64 ì²˜ë¦¬
      },
    },
  ],
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

- **CORS ì •ì±…ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš°íšŒ ë¶ˆê°€** â€” ì„œë²„ê°€ í—ˆìš©í•˜ì§€ ì•Šìœ¼ë©´ JavaScriptì—ì„œëŠ” ì´ë¯¸ì§€ ì ‘ê·¼ ì°¨ë‹¨ë¨
- **CSSì— í¬í•¨ëœ ì™¸ë¶€ ì´ë¯¸ì§€ë„ ë™ì¼í•œ ë¬¸ì œ** ë°œìƒí•¨
- ì™¸ë¶€ ë„ë©”ì¸ì˜ ì´ë¯¸ì§€ë‚˜ ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•  ê²½ìš°ì—” **ê°€ëŠ¥í•˜ë©´ ì‚¬ì „ì— base64 ë³€í™˜**í•˜ê±°ë‚˜, **ì„œë²„ ì¸¡ì—ì„œ ì²˜ë¦¬**í•˜ëŠ” ê²Œ ì•ˆì „í•¨

---

## ğŸ–¼ ì˜ˆì‹œ: html-to-image ì ìš© ì½”ë“œ

```ts
import { toPng } from 'html-to-image';

toPng(document.querySelector('#capture'), {
  skipFonts: true,
})
.then((dataUrl) => {
  const link = document.createElement('a');
  link.href = dataUrl;
  link.download = 'capture.png';
  link.click();
})
.catch((err) => {
  console.error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:', err);
});
```

---

## ğŸ§¶ ë§ˆë¬´ë¦¬

`html-to-image`ë‚˜ `html2canvas`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì™¸ë¶€ ì´ë¯¸ì§€ì™€ CSS ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ CORS ë¬¸ì œë¥¼ ë°˜ë“œì‹œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. Base64 ì²˜ë¦¬ë‚˜ ì„œë²„ í”„ë¡ì‹œ ë“±ì˜ ìš°íšŒ ë°©ë²•ì„ í†µí•´ ì•ˆì •ì ìœ¼ë¡œ ì´ë¯¸ì§€ ì¶”ì¶œì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
